---
output:
  github_document:
    html_preview: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- Use snippet 'render_markdown' for it -->

```{r,echo=FALSE}
knitr::opts_chunk$set(
  collapse=TRUE,
  comment="#>",
  fig.path="README-figures/"
)
```

# taxlist

<!-- Budges -->
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/taxlist)](https://cran.r-project.org/package=taxlist)
[![Rdoc](http://www.rdocumentation.org/badges/version/taxlist)](http://www.rdocumentation.org/packages/taxlist)
[![DOI](https://zenodo.org/badge/54913161.svg)](https://zenodo.org/badge/latestdoi/54913161)
<br>
[![Travis Build Status](https://travis-ci.org/kamapu/taxlist.svg?branch=master)](https://travis-ci.org/kamapu/taxlist)
[![codecov](https://codecov.io/gh/kamapu/taxlist/branch/master/graph/badge.svg)](https://codecov.io/gh/kamapu/taxlist)
<br>
[![CRAN_downloads](http://cranlogs.r-pkg.org/badges/taxlist)](https://cran.r-project.org/package=taxlist)
[![total downloads](http://cranlogs.r-pkg.org/badges/grand-total/taxlist)](https://cran.r-project.org/package=taxlist)

The aim of `taxlist` is to provide an object structure for taxonomic lists
and methods to display and handle the contained information.
We welcome any interest to implement it or to contribute in the development of
`taxlist`.

Objects and functions of `taxlist` are also implemented as part of objects
containing information from vegetation-plot databases (look at
[vegtable](https://github.com/kamapu/vegtable)).
The structure of `taxlist` objects is strongly inspired on data handled by
[Turboveg](https://www.synbiosys.alterra.nl/turboveg) and on relational
database models.

![](README-figures/taxlist_model.png)<br/>
**Figure:** Relational model for taxlist objects (see [Alvarez & Luebert
2018](https://doi.org/10.3897/BDJ.6.e23635)).

The functions in this package has being used to structure and clean data stored
in [SWEA-Dataveg](http://www.givd.info/ID/AF-00-006), a vegetation-plot database
managed in the context of the project
[GlobE-wetlands](https://www.wetlands-africa.de) and currently exported to a
[PostgreSQL](https://www.postgresql.org) format.

## Installing taxlist
Two alternative options are available for the installation of taxlist.
The first one is installing from the repository at
[CRAN](https://cran.r-project.org/package=taxlist):

```{r, eval=FALSE}
install.packages("taxlist", dependencies=TRUE)
```

The second alternative is to install the developing version from
[GitHub](https://github.com/kamapu/taxlist).
For this you will require the package `devtools`:

```{r, eval=FALSE}
library(devtools)
install_github("kamapu/taxlist", build_vignette=TRUE)
```

## Building taxlist Objects

I will take an example from "Helechos de Chile" **(Gunkel 1984)** to demonstrate
how to construct a `taxlist` object from its building blocks.
The first step will be to generate an empty `taxlist` object:

```{r}
library(taxlist)

Fern <- new("taxlist")
summary(Fern)
```

As you can see, there is nothing in there.
We start including taxonomic levels, we like to insert in the list.
Remember, the levels have to be provided in an upward sequence, that is to say
from lower to higher levels:

```{r}
levels(Fern) <- c("variety","species","genus")
```
Then you can add a species:

```{r}
Fern <- add_concept(Fern, TaxonName="Asplenium obliquum", AuthorName="Forster",
	Level="species")
```

Then add varieties:

```{r}
Fern <- add_concept(Fern,
	TaxonName=c("Asplenium obliquum var. sphenoides",
		"Asplenium obliquum var. chondrophyllum"),
	AuthorName=c("(Kunze) Espinosa",
		"(Bertero apud Colla) C. Christense & C. Skottsberg"),
	Level="variety")
```

Finally add the genus and check the object:

```{r}
Fern <- add_concept(Fern, TaxonName="Asplenium", AuthorName="L.", Level="genus")
summary(Fern)

summary(Fern, "all")
```

Now set the parent-child relations.
Relating to the previous display, you know that the species (concept ID **1**)
is the parent of the varieties (IDs **2** and **3**), and the genus (ID **4**)
is the parent of the species (ID **1**).
Thus the relationships are set as:

```{r}
Fern <- update_concept(Fern, ConceptID=c(2,3), Parent=1)
Fern <- update_concept(Fern, ConceptID=1, Parent=4)
summary(Fern)
```

Similarly to the addition of concepts, you can also add synonyms:

```{r}
Fern <- add_synonym(Fern, ConceptID=2, TaxonName="Asplenium sphenoides",
	AuthorName="Kunze")
summary(Fern, "Asplenium sphenoides")
```

Hierarchical levels, parent-child relationships and synonyms are included in the
exemplary data `Easplist`.
For further functions, look to the package's manual.

## Similar Packages

The package `taxlist` follows similar tasks than
[`taxa`](https://github.com/ropensci/taxa), but both packages focus on the
implementation of different approaches for object oriented programming in **R**,
namely S4 and R6, respectively.
Additionally, `taxa` is rather developer-oriented, while `taxlist` attempts to
address people managing and analysing taxonomic and vegetation-plots
databases.
For a more extended comparison on the differences between both packages, you
can visit [this discussion](https://github.com/ropensci/taxa/issues/130).

Another task of `taxlist` is the access to species lists stored in [**Turboveg
2**](http://www.synbiosys.alterra.nl/turboveg), in a similar way as done by the
package [`vegdata`]( https://CRAN.R-project.org/package=vegdata).
The later package used to import single tables from a database into respective
data frames in **R**, while `taxlist` defines an class (also called `taxlist`)
able to contain all the information in one single object.
 
## Rmarkdown Integration

Another special area of application is the use of `taxlist` objects for writing
documens (reports, checklists, floras, see also 
[this poster](https://dx.doi.org/10.13140/RG.2.2.36713.90728)),
which is mainly provided by the function `print_name()`.

For instance you can insert at the beginning of the document with a hidden
chunk:

````markdown
`r ''````{r  echo=FALSE, message=FALSE, warning=FALSE}
library(taxlist)
data(Easplist)
```
````

You can than insert insert in your document inline codes, such as
<code>&grave;r print_name(Easplist, 206)&grave;</code>, which will insert
`r print_name(Easplist, 206)` in your document (note that the number is the ID
of the taxon concept in `Easplist`).
Fort a second mention of the same species, you can then use
<code>&grave;r print_name(Easplist, 206, second_mention=TRUE)&grave;</code>,
which will insert `r print_name(Easplist, 206, second_mention=TRUE)` in your
text.


## Descriptive Statistics

Information located in the slot **taxonTraits** are suitable for statistical
assessments.
For instance, in the installed object `Easplist` a column called
**lf_behn_2018** includes a classification of macrophytes into different life
forms.
To know the frequency of these life forms in the `Easplist`, we can use the
function `count_taxa()`:

```{r}
# how man taxa in 'Easplist'
count_taxa(Easplist)

# frequency of life forms
count_taxa(~ lf_behn_2018, Easplist)
```

Furthermore, taxonomic information can be also transferred to this slot using
the function `tax2traits()`.
By this way we will make taxonomic ranks suitable for frequency calculations.

```{r}
Easplist <- tax2traits(Easplist, get_names=TRUE)
head(Easplist@taxonTraits)
```

Note that the respective parental ranks are inserted in the table
**taxonTraits**, which contains the attributes of the taxa.
In the two next command lines, we will produce a subset with only members of
the family Cyperaceae and then calculate the frequency of species per genera.

```{r}
Cype <- subset(Easplist, family == "Cyperaceae", slot="taxonTraits")
Cype_stat <- count_taxa(species ~ genus, Cype)
```

Now, we can sort them to produce a nice bar plot.

```{r genera_bar}
Cype_stat <- Cype_stat[order(Cype_stat$species_count, decreasing=TRUE),]

par(las=2, mar=c(10,3,1,1))
with(Cype_stat, barplot(species_count, names.arg=genus))
```


## Acknowledgements

The author thanks **Stephan Hennekens**, developer of
[Turboveg](http://www.synbiosys.alterra.nl/turboveg), for his patience and great
support finding a common language between **R** and **Turboveg**, as well as for
his advices on formatting our taxonomic list **EA-Splist**.

Also thanks to **Federico Luebert** for the fruitful discussions regarding the
terminology used in this project.
